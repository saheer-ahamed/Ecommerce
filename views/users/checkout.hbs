<!--===============================================================================================-->
<link rel="icon" type="image/png" href="images/icons/favicon.png" />
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/fonts/linearicons-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/vendor/perfect-scrollbar/perfect-scrollbar.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="/css/util.css">
<link rel="stylesheet" type="text/css" href="/css/main.css">
<!--===============================================================================================-->
<style>
    .error {
        color: rgba(179, 0, 0, 0.842);
    }

    .vertical-alignment-helper {
        display: table;
        height: 100%;
        width: 100%;
        pointer-events: none;
        /* This makes sure that we can still click outside of the modal to close it */
    }

    .vertical-align-center {
        /* To center vertically */
        display: table-cell;
        vertical-align: middle;
        pointer-events: none;
    }

    .modal-content {
        /* Bootstrap sets the size of the modal in the modal-dialog class, we need to inherit it */
        width: inherit;
        max-width: inherit;
        /* For Bootstrap 4 - to avoid the modal window stretching full width */
        height: inherit;
        /* To center horizontally */
        margin: 0 auto;
        pointer-events: all;
    }

    input {
        width: 400px;
    }
</style>
</head>

<body class="animsition">

    <!-- Header -->
    <header class="header-v4">
        <!-- Header desktop -->
        <div class="container-menu-desktop">
            <!-- Topbar -->
            {{>user-header}}

            <!-- breadcrumb -->
            <div class="container">
                <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
                    <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
                        Home
                        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
                    </a>

                    <a href="/cart" class="stext-109 cl4">
                        Shopping Cart
                        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
                    </a>

                    <span class="stext-109 cl4">
                        Checkout
                    </span>
                </div>
            </div>

            <div class="mb-3 mt-3">
                <div class="container">
                    <p class="mx-4" style="text-decoration: underline;">
                        <strong>Add new shipping address or use any of these instead. </strong>
                    </p>
                    <div class="row mt-3 m-3">
                        {{#each eachAddresses}}
                        <a onclick="chosenAddress('{{this._id}}')" style="color: #000;">
                            <div class="col mb-3">
                                <div class="card" style="width: 15rem;">
                                    <div class="card-body">
                                        <ul style="text-decoration: none;">
                                            <li><strong>{{this.fullName}}</strong></li>
                                            <li>{{this.apartment}}, {{this.landmark}}</li>
                                            <li>{{this.state}}</li>
                                            <li>{{this.country}}</li>
                                            <li>{{this.pincode}}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </a>
                        {{/each}}
                    </div>
                </div>
            </div>


            <!-- Billing -->

            <div class="container mt-5">
                <div class="row">
                    <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                        <div class="m-l-25 m-r--38 m-lr-0-xl">
                            <h4 class="mb-3">Billing address</h4>
                            <form action="" method="post" id="checkout-form">
                                <div class="row g-3">
                                    <div class="col-sm-12 mt-3 mb-3">
                                        <input type="text" class="form-control" name="fullName" id="fullName"
                                            placeholder="Full Name" required>
                                    </div>

                                    <div class="col-12 mt-3 mb-3">
                                        <input type="text" class="form-control" name="apartment" id="apartment"
                                            placeholder="Flat, House no., Building, Company, Apartment" required>
                                    </div>

                                    <div class="col-12 mt-3 mb-3">
                                        <input type="text" class="form-control" name="street" id="street"
                                            placeholder="Area, Street, Sector, Village" required>
                                    </div>

                                    <div class="col-12 mt-3 mb-3">
                                        <div class="input-group has-validation">
                                            <input type="text" class="form-control" name="landmark" id="landmark"
                                                placeholder="Landmark" required>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-3 mb-3">
                                        <input type="number" class="form-control" name="mobile" id="mobile"
                                            placeholder="Mobile Number" required>
                                    </div>

                                    <div class="col-md-5">
                                        <label for="country" class="form-label">Country</label>
                                        <select class="form-select" name="country" id="country" required>
                                            <option value="">Choose...</option>
                                            <option>India</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="state" class="form-label">State</label>
                                        <select class="form-select" name="state" id="state" required>
                                            <option value="">Choose...</option>
                                            <option name="Kerala">Kerala</option>
                                            <option name="Tamil-Nadu">Tamil Nadu</option>
                                        </select>
                                    </div>

                                    <div class="col-md-3 mt-3">
                                        <input type="number" class="form-control" name="pincode" id="pincode"
                                            placeholder="Pincode [6 digits]">
                                    </div>
                                </div>

                                <hr class="my-4">

                                <h4 class="mb-3">Payment</h4>

                                <div class="my-3">
                                    <div class="form-check m-3">
                                        <input id="paypal" name="payment" value="PayPal" type="radio"
                                            class="form-check-input" disabled required>
                                        <label class="form-check-label" for="paypal">PayPal</label>
                                    </div>
                                    <div class="form-check m-3">
                                        <input id="Razorpay" name="payment" value="Razorpay" type="radio"
                                            class="form-check-input" required>
                                        <label class="form-check-label" for="Razorpay">Razorpay</label>
                                    </div>
                                    <div class="form-check m-3">
                                        <input id="COD" name="payment" value="COD" type="radio" class="form-check-input"
                                            checked required>
                                        <label class="form-check-label" for="COD">Cash on Delivery</label>
                                    </div>
                                </div>



                                <hr class="my-4">
                                <button type="submit" class="btn btn-dark p-3"> Place Order</button>


                            </form>
                        </div>


                    </div>


                    <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50 mt-5">
                        <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                            <h4 class="mtext-109 cl2 p-b-30">
                                Cart Totals
                            </h4>
                            {{#each fullCartProds.cart}}
                            <div class="flex-w flex-t bor12 mt-3">
                                <div class="size-208 gx-3">
                                    <span class="stext-110 cl2">
                                        {{this.product.productName}}
                                    </span>
                                    <span class="mtext-110 cl2">
                                        ({{this.quantity}}
                                    </span>
                                    *
                                    <span class="mtext-110 cl2">
                                        ₹ {{this.product.sellPrice}})
                                    </span>
                                </div>
                            </div>
                            {{/each}}
                            <div class="flex-w flex-t mt-3">
                                <div class="size-208">
                                    <span class="stext-110 cl2">
                                        Subtotal:
                                    </span>
                                </div>

                                <div class="size-209">
                                    <span class="mtext-110 cl2" id="subtotal">
                                        ₹ <span id="SubTotal">{{fullCartProds.SubTotal}}</span>
                                    </span>
                                </div>
                            </div>

                            <div class="flex-w flex-t mt-3">
                                <div class="size-208">
                                    <span class="stext-110 cl2">
                                        Coupon Discount:
                                    </span>
                                </div>

                                <div class="size-209">
                                    <span class="mtext-110 cl2" id="discountField">
                                        ₹ {{#if coupon}}
                                        {{coupon.discount}}
                                        {{else}}
                                        0
                                        {{/if}}
                                    </span>
                                </div>
                            </div>

                            <div class="flex-w flex-t p-t-27 ">
                                <div class="size-208">
                                    <span class="mtext-101 cl2">
                                        Total:
                                    </span>
                                </div>

                                <div class="size-209 p-t-1">
                                    <span class="mtext-110 cl2">
                                        ₹ <span id="Total">{{fullCartProds.Total}}</span>
                                    </span>
                                </div>
                            </div>
                            <div class="mt-5">
                                <div class="flex-w flex-m m-r-20 m-tb-5">
                                    <input class="border border-dark p-2" style="border-radius: 10px;" type="text"
                                        name="couponCode" placeholder="Coupon Code" id="couponCode">
                                </div>
                                <div class="d-flex justify-content-start">
                                    <button onclick="applyCoupon()"
                                        class="ml-2 flex-c-m stext-101 cl2 p-2 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-5">
                                        Apply coupon
                                    </button>
                                    <a class="mt-3 ml-3 text-danger" data-bs-toggle="modal"
                                        data-bs-target="#couponsModal">
                                        Get Coupon Codes
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Modal -->
            <div class="modal fade" id="couponsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true">
                <div class="vertical-alignment-helper">
                    <div class="modal-dialog vertical-align-center">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-bs-dismiss="modal"><span
                                        aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h3>Coupons</h3>
                            </div>
                            <div class="modal-body d-flex flex-column justify-content-center">
                                {{#each coupons}}
                                <div class="d-flex flex-row mt-3">
                                    <input type="text" id="copyTarget" value="{{this.couponCode}}"
                                        class="p-3 border border-dark" readonly>
                                    <button id="copyButton">
                                        <i class="ml-3 fa fa-clipboard" style="font-size:24px"></i>
                                    </button>
                                </div>
                                {{/each}}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Footer -->
            {{>footer}}


            <!-- Back to top -->
            <div class="btn-back-to-top" id="myBtn">
                <span class="symbol-btn-back-to-top">
                    <i class="zmdi zmdi-chevron-up"></i>
                </span>
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
            <!--===============================================================================================-->
            <script src="/vendor/jquery/jquery-3.2.1.min.js"></script>
            <!--===============================================================================================-->
            <script src="/vendor/animsition/js/animsition.min.js"></script>
            <!--===============================================================================================-->
            <script src="/vendor/bootstrap/js/popper.js"></script>
            <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
            <!--===============================================================================================-->
            <script src="/vendor/select2/select2.min.js"></script>
            <script>
                $(".js-select2").each(function () {
                    $(this).select2({
                        minimumResultsForSearch: 20,
                        dropdownParent: $(this).next('.dropDownSelect2')
                    });
                })
            </script>
            <!--===============================================================================================-->
            <script src="/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
            <!--===============================================================================================-->
            <script src="/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
            <script>
                $('.js-pscroll').each(function () {
                    $(this).css('position', 'relative');
                    $(this).css('overflow', 'hidden');
                    var ps = new PerfectScrollbar(this, {
                        wheelSpeed: 1,
                        scrollingThreshold: 1000,
                        wheelPropagation: false,
                    });

                    $(window).on('resize', function () {
                        ps.update();
                    })
                });
            </script>



            {{!--
            <script>
                $(document).ready(function () {
                    $("#needs-validation").validate({
                        rules: {
                            firstName: {
                                required: true
                            },
                            lastName: {
                                required: true
                            },
                            userName: {
                                required: true
                            },
                            email: {
                                email: true,
                                required: true,
                            },
                            deliveryAddress: {
                                required: true,
                            },
                            mobile: {
                                required: true,
                                range: [6000000000, 9999999999],
                                minlength: 10,
                                maxlength: 10,
                                digits: true
                            },
                            country: {
                                required: true,
                            },
                            state: {
                                required: true,
                            },
                            zipCode: {
                                required: true,
                                digits: true,
                                minlength: 5,
                                maxlength: 10
                            },
                        },
                        messages: {
                            mobile: {
                                range: "Please enter 1st digit between 6 to 9."
                            }
                        }
                    });
                });

            </script> --}}
            <script>

                document.getElementById("copyButton").addEventListener("click", function () {
                    copyToClipboard(document.getElementById("copyTarget"));
                });

                function copyToClipboard(elem) {
                    // create hidden text element, if it doesn't already exist
                    var targetId = "_hiddenCopyText_";
                    var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
                    var origSelectionStart, origSelectionEnd;
                    if (isInput) {
                        // can just use the original source element for the selection and copy
                        target = elem;
                        origSelectionStart = elem.selectionStart;
                        origSelectionEnd = elem.selectionEnd;
                    } else {
                        // must use a temporary form element for the selection and copy
                        target = document.getElementById(targetId);
                        if (!target) {
                            var target = document.createElement("textarea");
                            target.style.position = "absolute";
                            target.style.left = "-9999px";
                            target.style.top = "0";
                            target.id = targetId;
                            document.body.appendChild(target);
                        }
                        target.textContent = elem.textContent;
                    }
                    // select the content
                    var currentFocus = document.activeElement;
                    target.focus();
                    target.setSelectionRange(0, target.value.length);

                    // copy the selection
                    var succeed;
                    try {
                        succeed = document.execCommand("copy");
                    } catch (e) {
                        succeed = false;
                    }
                    // restore original focus
                    if (currentFocus && typeof currentFocus.focus === "function") {
                        currentFocus.focus();
                    }

                    if (isInput) {
                        // restore prior selection
                        elem.setSelectionRange(origSelectionStart, origSelectionEnd);
                    } else {
                        // clear temporary content
                        target.textContent = "";
                    }
                    return succeed;
                }
            </script>


            <script>
                $(document).ready(function () {
                    $("#checkout-form").submit((e) => {
                        e.preventDefault()
                        $.ajax({
                            url: '/placed-order',
                            method: 'post',
                            data: $('#checkout-form').serialize(),
                            success: (response) => {
                                if (response.status) {
                                    razorpayPayment(response)
                                } else {
                                    location.href = '/orderSuccess';
                                }
                            }
                        })
                    })
                })
            </script>

            <script src="/assets/dist/js/bootstrap.bundle.min.js"></script>
            <style>
                .card {
                    box-shadow: 0 6px 10px rgba(0, 0, 0, .08), 0 0 6px rgba(0, 0, 0, .05);
                    transition: .3s transform cubic-bezier(.155, 1.105, .295, 1.12), .3s box-shadow, .3s -webkit-transform cubic-bezier(.155, 1.105, .295, 1.12);
                    cursor: pointer;
                }

                .card:hover {
                    transform: scale(1.05);
                    box-shadow: 0 10px 20px rgba(0, 0, 0, .12), 0 4px 8px rgba(0, 0, 0, .06);
                }
            </style>
            <!--===============================================================================================-->
            <script src="/js/main.js"></script>

</body>

</html>